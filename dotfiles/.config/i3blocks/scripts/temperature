#!/usr/bin/env bash

TEMP=""

# Try CPU thermal zone
if [ -f /sys/class/thermal/thermal_zone0/temp ]; then
    TEMP_RAW=$(cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null)
    if [ -n "$TEMP_RAW" ] && [ "$TEMP_RAW" != "0" ]; then
        TEMP=$((TEMP_RAW / 1000))
    fi
elif command -v sensors >/dev/null 2>&1; then
    # Try lm-sensors
    TEMP=$(sensors 2>/dev/null | grep -E "Core 0|Package id 0|Tctl" | head -1 | grep -oE '[0-9]+\.[0-9]+°C' | cut -d'°' -f1 | cut -d'.' -f1)
fi

if [ -n "$TEMP" ]; then
    # Create temperature status text
    create_temp_status() {
        local temp=$1
        if [ "$temp" -lt 60 ]; then
            echo "[COOL]"
        elif [ "$temp" -lt 80 ]; then
            echo "[WARM]"
        else
            echo "[HOT!]"
        fi
    }
    
    # Color-coded temperature thresholds with dots
    if [ "$TEMP" -lt 60 ]; then
        COLOR="#b4be82"  # Green
        DOT="●"
    elif [ "$TEMP" -lt 80 ]; then
        COLOR="#e2c792"  # Yellow
        DOT="●"
    else
        COLOR="#e27878"  # Red
        DOT="●"
    fi
    
    TEMP_STATUS=$(create_temp_status $TEMP)
    echo "<span color='$COLOR'>$DOT TMP $TEMP_STATUS</span> ${TEMP}°C"
else
    echo "<span color='#6b7089'>● TMP [N/A]</span> Unknown"
fi
